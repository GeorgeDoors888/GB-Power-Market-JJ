#!/bin/bash
# Guide: Change Apps Script GCP Project to Enable API Deployment

echo "ğŸ”§ OPTION A: Link Apps Script to Service Account's Project"
echo "============================================================"
echo ""
echo "ğŸ“‹ Current State:"
echo "   Apps Script GCP Project: jibber-jabber-knowledge (1090450657636)"
echo "   Service Account Project: inner-cinema-476211-u9 (922809339325)"
echo "   Status: âŒ Different projects = No API access"
echo ""
echo "ğŸ“‹ Target State:"
echo "   Apps Script GCP Project: inner-cinema-476211-u9 (922809339325)"
echo "   Service Account Project: inner-cinema-476211-u9 (922809339325)"
echo "   Status: âœ… Same project = Automatic API access"
echo ""
echo "============================================================"
echo "STEP-BY-STEP INSTRUCTIONS"
echo "============================================================"
echo ""
echo "I've opened the Apps Script Settings page for you."
echo "Now follow these steps:"
echo ""
echo "1ï¸âƒ£  Find the section: 'Google Cloud Platform (GCP) project'"
echo "    Current value shows: 1090450657636"
echo ""
echo "2ï¸âƒ£  Click: 'Change project' button"
echo ""
echo "3ï¸âƒ£  A dialog will appear with two steps:"
echo ""
echo "    Step 1: Instructions (just read them)"
echo "    Step 2: Enter project number"
echo ""
echo "4ï¸âƒ£  In Step 2, enter this number:"
echo ""
echo "    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "    â”‚  922809339325                       â”‚"
echo "    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "5ï¸âƒ£  You'll see a warning message:"
echo "    'âš ï¸  All user authentications for your old project will be"
echo "     permanently revoked.'"
echo ""
echo "    This is NORMAL and EXPECTED. Click 'Set project' anyway."
echo ""
echo "6ï¸âƒ£  The page will refresh and show:"
echo "    GCP Project: 922809339325"
echo ""
echo "============================================================"
echo "WHAT THIS DOES"
echo "============================================================"
echo ""
echo "âœ… Links Apps Script to inner-cinema-476211-u9"
echo "âœ… Grants service account automatic access"
echo "âœ… Enables Apps Script API deployment"
echo "âœ… Connects to your BigQuery data (same project)"
echo ""
echo "âš ï¸  Will revoke existing OAuth tokens (you'll re-authorize)"
echo "âš ï¸  Can't revert to jibber-jabber-knowledge (permanent change)"
echo ""
echo "============================================================"
echo "AFTER CHANGING THE PROJECT"
echo "============================================================"
echo ""
echo "Once you've entered 922809339325 and clicked 'Set project':"
echo ""
echo "1. Wait 30 seconds for changes to propagate"
echo ""
echo "2. Run this command:"
echo "   python3 update_existing_script.py"
echo ""
echo "3. You should see:"
echo "   âœ… Successfully updated script content!"
echo "   ğŸ”— Links to your sheet and script"
echo ""
echo "4. Refresh your Google Sheet (Cmd+R)"
echo ""
echo "5. Look for menu: âš¡ Power Market"
echo ""
echo "6. Click: âš¡ Power Market â†’ ğŸš€ One-Click Setup"
echo ""
echo "7. Authorize when prompted (one-time)"
echo ""
echo "8. Done! Dashboard will auto-refresh every 5 minutes"
echo ""
echo "============================================================"
echo "READY TO PROCEED?"
echo "============================================================"
echo ""
echo "Go to the Apps Script Settings page and:"
echo "  â€¢ Click 'Change project'"
echo "  â€¢ Enter: 922809339325"
echo "  â€¢ Click 'Set project'"
echo ""
echo "Then run: python3 update_existing_script.py"
echo ""

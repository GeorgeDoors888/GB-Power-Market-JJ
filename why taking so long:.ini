why taking so long:  
> # Look for scripts that update BM Revenue Analysis
> bm_scripts = glob.glob('*bm*revenue*.py') + glob.glob('*vlp*.py')
> print('ğŸ“‹ BM Revenue Analysis Scripts Found:')
> for script in sorted(bm_scripts):
>     if os.path.isfile(script):
>         print(f'  - {script}')
> "
ğŸ“‹ BM Revenue Analysis Scripts Found:
  - add_vlp_correct_calculation.py
  - analyze_battery_vlp_final.py
  - analyze_vlp_bm_revenue.py
  - analyze_vlp_bm_revenue.py
  - analyze_vlp_pricing.py
  - analyze_vlp_simple.py
  - calculate_bess_vlp_detailed_breakdown.py
  - calculate_bess_vlp_revenue.py
  - calculate_bess_vlp_revenue_2_5mw.py
  - complete_vlp_battery_analysis.py
  - comprehensive_vlp_analysis.py
  - create_bess_vlp_sheet.py
  - create_vlp_charts.py
  - create_vlp_json.py
  - create_vlp_tables.py
  - download_and_analyze_vlp.py
  - enhance_bess_vlp_sheet.py
  - enhance_dashboard_with_vlp.py
  - fix_vlp_real_bp_units.py
  - fix_vlp_real_data.py
  - format_vlp_dashboard.py
  - load_vlp_to_sheets.py
  - refresh_vlp_dashboard.py
  - research_vlp_aggregators.py
  - test_bess_vlp_lookup.py
  - update_battery_bm_revenue.py
  - update_battery_bm_revenue_v1_backup.py
  - update_battery_bm_revenue_v2.py
  - update_battery_bm_revenue_v2_optimized.py
  - update_bm_revenue_market_wide.py
  - vlp_add_data_alerts.py
  - vlp_apply_professional_layout.py
  - vlp_auto_refresh.py
  - vlp_charts_python.py
  - vlp_dashboard_python.py
  - vlp_dashboard_simple.py
  - vlp_detailed_view.py
  - vlp_realistic_revenue_calculation.py
  - vlp_stacking_analysis.py
  - vlp_unit_tracker.py
  - vlp_webhook_server.py
[george@localhost GB-Power-Market-JJ]$ python3 update_bm_revenue_market_wide.py

================================================================================
ğŸ”‹ MARKET-WIDE BM REVENUE ANALYSIS - 2025-12-13
================================================================================

ğŸ” Discovering active BMUs from Elexon API (sampling SP 24)...
âœ… Discovered 131 active BMUs

ğŸ“ˆ Analyzing 100 BMUs (limited to 100 for performance)

â³ Fetching settlement data (this will take a few minutes)...
  [1/100] 2__ASTAT005... Â£1,535 | 17.3 MWh | Offer
  [2/100] 2__ASTAT008... Â£1,014 | 11.8 MWh | Offer
  [3/100] 2__BFSEN006... Â£6,039 | 70.7 MWh | Offer
  [4/100] 2__FBPGM001... Â£8,438 | 88.2 MWh | Offer
  [5/100] 2__FFSEN007... Â£-1,916 | 43.2 MWh | Bid
  [6/100] 2__GCMRO001... Â£5,711 | 64.9 MWh | Offer
  [7/100] 2__GCMRO002... Â£3,117 | 37.6 MWh | Offer
  [8/100] 2__GFLEX008... Â£3,507 | 35.9 MWh | Offer
  [9/100] 2__GSTAT009... Â£984 | 10.2 MWh | Offer
  [10/100] 2__HLOND002... Â£6,870 | 91.4 MWh | Offer
  [11/100] 2__HSTAT002... Â£2,653 | 28.1 MWh | Offer
  [12/100] 2__HSTAT007... Â£2,475 | 27.0 MWh | Offer
  [13/100] 2__LANGE002... Â£785 | 8.8 MWh | Offer
  [14/100] 2__LFLEX001... Â£2,663 | 26.3 MWh | Offer
  [15/100] 2__MCMRO002... Â£6,173 | 160.6 MWh | Offer
  [16/100] 2__MCMRO003... Â£22,176 | 253.6 MWh | Offer
  [17/100] 2__MSTAT005... Â£881 | 9.6 MWh | Offer
  [18/100] 2__NHPOW001... Â£-2,985 | 117.6 MWh | Bid
  [19/100] 2__NHPOW003... Â£-34,269 | 517.3 MWh | Bid
  [20/100] 2__NSTAT004... Â£-2,541 | 93.7 MWh | Bid
  [21/100] 2__PFLEX001... Â£-1,479 | 76.4 MWh | Bid
  [22/100] 2__PFLEX002... Â£-11,470 | 381.1 MWh | Bid
  [23/100] 2__PSTAT001... Â£-45,521 | 551.0 MWh | Bid
  [24/100] C__PSTAT011... Â£-63,656 | 959.8 MWh | Bid
  [25/100] E_ARBRB-1... Â£-3,237 | 159.8 MWh | Bid
  [26/100] E_BABAW-1... Â£-62,403 | 802.8 MWh | Bid
  [27/100] E_BLARW-1... Â£-15,523 | 480.2 MWh | Bid
  [28/100] E_BTUIW-2... Â£-19,178 | 239.6 MWh | Bid
  [29/100] E_BTUIW-3... Â£-6,527 | 918.0 MWh | Bid
  [30/100] E_CHAPB-1... Â£3,700 | 47.2 MWh | Offer
  [31/100] E_CLAC-1... Â£-39,144 | 640.7 MWh | Bid
  [32/100] E_CLAYB-1... Â£661 | 19.0 MWh | Offer
  [33/100] E_CLAYB-2... Â£939 | 19.8 MWh | Offer
  [34/100] E_CONTB-1... Â£760 | 28.5 MWh | Offer
  [35/100] E_CRSSB-1... Â£819 | 9.9 MWh | Offer
  [36/100] E_DOLLB-1... Â£3,274 | 35.5 MWh | Offer
  [37/100] E_GRCRB-1... Â£351 | 3.5 MWh | Offer
  [38/100] E_GRGRW-1... Â£-42,156 | 617.5 MWh | Bid
  [39/100] E_HAWKB-1... Â£2,965 | 40.5 MWh | Offer
  [40/100] E_ILMEB-1... Â£8,348 | 105.5 MWh | Offer
  [41/100] E_NEWPB-1... Â£2,708 | 27.1 MWh | Offer
  [42/100] E_OLDHB-1... Â£269 | 3.9 MWh | Offer
  [43/100] E_PILLB-1... Â£3,789 | 49.7 MWh | Offer
  [44/100] E_PILLB-2... Â£2,150 | 29.1 MWh | Offer
  [45/100] E_SHILB-1... Â£-2,803 | 135.3 MWh | Bid
  [46/100] E_SHOS-1... Â£874,711 | 9407.6 MWh | Offer
  [47/100] E_SKELB-1... Â£3,034 | 157.5 MWh | Offer
  [48/100] E_THMRB-1... Â£6,578 | 88.2 MWh | Offer
  [49/100] T_BENBW-1... Â£-5,256 | 673.6 MWh | Bid
  [50/100] T_BHLAW-1... Â£-171,934 | 2165.8 MWh | Bid
  [51/100] T_BLHLB-1... Â£-8,059 | 236.9 MWh | Bid
  [52/100] T_BLHLB-2... Â£-4,742 | 145.6 MWh | Bid
  [53/100] T_BREDB-1... Â£9,128 | 90.2 MWh | Offer
  [54/100] T_BROCW-1... Â£-22,473 | 574.8 MWh | Bid
  [55/100] T_BUSTB-1... Â£4,079 | 41.4 MWh | Offer
  [56/100] T_CDCL-1... Â£771,046 | 8382.8 MWh | Offer
  [57/100] T_CNQPS-2... Â£411,415 | 4516.7 MWh | Offer
  [58/100] T_CNQPS-3... Â£159,889 | 1554.6 MWh | Offer
  [59/100] T_COSO-1... Â£915,495 | 9687.8 MWh | Offer
  [60/100] T_COVNB-1... Â£17,799 | 221.9 MWh | Offer
  [61/100] T_COWB-1... Â£1,046 | 11.8 MWh | Offer
  [62/100] T_CRDEW-1... Â£-13,590 | 251.0 MWh | Bid
  [63/100] T_CRDEW-2... Â£-13,590 | 251.0 MWh | Bid
  [64/100] T_CREAW-1... Â£-75,202 | 1477.2 MWh | Bid
  [65/100] T_CRMLW-1... Â£-61,650 | 756.8 MWh | Bid
  [66/100] T_CRUA-3... Â£-50,022 | 3187.0 MWh | Bid
  [67/100] T_CRUA-4... Â£-55,574 | 3311.3 MWh | Bid
  [68/100] T_CUMHW-1... Â£-19,722 | 850.9 MWh | Bid
  [69/100] T_DALQW-1... Â£-37,229 | 625.8 MWh | Bid
  [70/100] T_DOREW-1... Â£-89,029 | 1865.8 MWh | Bid
  [71/100] T_DOREW-2... Â£-73,151 | 1540.0 MWh | Bid
  [72/100] T_DOUGW-1... Â£-18,393 | 628.7 MWh | Bid
  [73/100] T_DUNGW-1... Â£-136,865 | 1612.2 MWh | Bid
  [74/100] T_EDINW-1... Â£-16,223 | 155.6 MWh | Bid
  [75/100] T_ERRO-3... Â£-30,301 | 516.3 MWh | Bid
  [76/100] T_FOYE-1... Â£-85,563 | 4599.7 MWh | Bid
  [77/100] T_FOYE-2... Â£-115,118 | 4380.0 MWh | Bid
  [78/100] T_GLNKW-1... Â£-71,557 | 999.5 MWh | Bid
  [79/100] T_GORDW-1... Â£-105,561 | 1301.3 MWh | Bid
  [80/100] T_GORDW-2... Â£-4,571 | 642.0 MWh | Bid
  [81/100] T_GRAI-6... Â£272,382 | 3062.4 MWh | Offer
  [82/100] T_GRAI-7... Â£282,072 | 3176.3 MWh | Offer
 please do a todo list for this . update a md file with this imfomation and functionality. add these kpi wheere I have put them in the sheet: Accepted MWh (Offer / Bid)		Net BM Revenue (Â£)		Constraint Share (% DISBSAD)	
Active SPs (X/48)		Â£/MW-day		Non-Delivery Rate (%)	
VWAP (Â£/MWh)		Offer/Bid Ratio			
					  see Below are BigQuery queries (as â€œone-linersâ€ where possible). Iâ€™m assuming your tables look like you previously referenced (bmrs_boalf, bmrs_bmu, etc.). If your dataset uses different names/fields, keep the logic and swap the table/field names.
# BM Revenue & Market KPIs (Daily â€œ00:00â†’Nowâ€ + Year Benchmarks)

This is a KPI pack you can compute from **Elexon Insights / BMRS / IRIS-style APIs** (no private NESO feeds), designed for:
- **Today so far** (from **00:00 Europe/London** to â€œnowâ€)
- **Daily full-day** rollups
- **Benchmarking vs YTD mean/min/max/percentiles/z-scores**

> **Important data-quality note:** the settlement-style endpoints for **BOAV** and **EBOCF** return values from the **latest settlement run only** for each Settlement Period on a date. îˆ€citeîˆ‚turn0search1îˆ‚turn0search2îˆ  
> Pair-level â€œderived dataâ€ exists in the Insights UI (â€œestimate of accepted volumes for each Bid-Offer pairâ€¦ period cash flowâ€). îˆ€citeîˆ‚turn0search5îˆ

---

## 1) Data sources you can rely on

### BOALF â€” acceptance-level dispatch (operational)
- Purpose: counts, intensity, timing, MW steps, acceptance windows.
- API: â€œBid Offer Acceptance Level Flagged (BOALF)â€¦ provides bid offer acceptance data.â€ îˆ€citeîˆ‚turn0search4îˆ
- Definition: a BOA is â€œshownâ€¦ as a MW levelâ€¦ at the beginning and at the end of the Acceptanceâ€¦ start and end timeâ€¦â€ îˆ€citeîˆ‚turn0search17îˆ

### BOD â€” submitted bid/offer stack (pricing & availability)
- Purpose: stack depth, defensive pricing, spreads, MW bands.
- API: â€œBid Offer Data (BOD)â€¦ provides bid-offer data.â€ îˆ€citeîˆ‚turn0search3îˆ
- Glossary: a Bid-Offer pair has an identifying number and both bid/offer prices. îˆ€citeîˆ‚turn0search7îˆ

### BOAV â€” settlement acceptance volumes (by SP/date; bid or offer)
- Purpose: per-SP accepted **MWh** totals at settlement level.
- API: â€œReturns the settlement acceptance volumesâ€¦ only messages generated for the latest settlement run are returned.â€ îˆ€citeîˆ‚turn0search1îˆ

### EBOCF â€” indicative BMU cashflows (by SP/date; bid or offer)
- Purpose: per-SP indicative **Â£ cashflow** totals at settlement level.
- API: â€œReturns derived indicative cashflow dataâ€¦ latest calculation runâ€¦ only messagesâ€¦ latest settlement run.â€ îˆ€citeîˆ‚turn0search2îˆ

---

## 2) â€œToday so farâ€ time window rules

**TodaySoFar window**:
- Start: **00:00 local (Europe/London)**
- End: current time rounded down to the nearest minute (or SP boundary if you want clean SP counts)

**Two recommended variants**
1) **SP-complete**: include only fully completed Settlement Periods (cleanest for daily tracking)
2) **Real-time**: include partial SP using BOALF acceptance times (best for â€œlive deskâ€ monitoring)

---

## 3) KPI definitions (ready for cell Notes)

Format:
- **KPI_ID**
- **Name (Unit)**
- **Level**
- **Definition (short cell note)**
- **Formula / How to calculate**
- **Primary data source(s)**

### A) Market-wide (all BMUs) â€” BM â€œmarket performanceâ€

**KPI_MKT_001 â€” Total BM Cashflow (Â£) TodaySoFar**  
- Level: Market  
- Cell note: Total indicative BM cashflow across all BMUs from 00:00 to now.  
- Formula: sum(EBOCF_bid_cashflow + EBOCF_offer_cashflow) over window  
- Sources: EBOCF (bid + offer) îˆ€citeîˆ‚turn0search2îˆ

**KPI_MKT_002 â€” Total Accepted Volume (MWh) TodaySoFar**  
- Level: Market  
- Cell note: Total accepted MWh across all BMUs from 00:00 to now.  
- Formula: sum(BOAV_bid_MWh + BOAV_offer_MWh)  
- Sources: BOAV îˆ€citeîˆ‚turn0search1îˆ

**KPI_MKT_003 â€” System â€œDirectionâ€ (Net MWh) TodaySoFar**  
- Level: Market  
- Cell note: Net accepted energy = offers (system buying energy) minus bids (system selling energy).  
- Formula: netMWh = offerMWh âˆ’ bidMWh  
- Sources: BOAV îˆ€citeîˆ‚turn0search1îˆ

**KPI_MKT_004 â€” Energy-weighted Price (EWAP) (Â£/MWh)**  
- Level: Market  
- Cell note: Total cashflow Ã· total MWh for bids/offers (energy-weighted).  
- Formula: EWAP_offer = offerCashflow/offerMWh; EWAP_bid = bidCashflow/bidMWh; EWAP_net = totalCashflow/totalMWh  
- Sources: BOAV + EBOCF îˆ€citeîˆ‚turn0search1îˆ‚turn0search2îˆ

**KPI_MKT_005 â€” Dispatch Intensity (acceptances/hour)**  
- Level: Market  
- Cell note: How â€œbusyâ€ the BM isâ€”count of BOALF acceptances per hour (all BMUs).  
- Formula: count(BOALF.acceptanceNumber) / hoursElapsed  
- Sources: BOALF îˆ€citeîˆ‚turn0search4îˆ‚turn0search17îˆ

**KPI_MKT_006 â€” Concentration (Top 1 / Top 5 share of Â£)**  
- Level: Market  
- Cell note: % of market BM cashflow earned by the top BMU(s) (dominance).  
- Formula: (sum Â£ for top N BMUs) / (total Â£)  
- Sources: EBOCF îˆ€citeîˆ‚turn0search2îˆ

**KPI_MKT_007 â€” â€œWorkhorse indexâ€ (Active SPs/48)**  
- Level: Market or Fleet  
- Cell note: Fraction of SPs with non-zero accepted MWh.  
- Formula: activeSPs = countDistinct(SP where BOAV_MWh>0); index = activeSPs/48  
- Sources: BOAV îˆ€citeîˆ‚turn0search1îˆ

---

### B) BMU-level (per battery or any BMU) â€” revenue & utilisation

**KPI_BMU_001 â€” Net BM Revenue (Â£) TodaySoFar**  
- Level: BMU  
- Cell note: Indicative bid+offer cashflow for this BMU from 00:00 to now.  
- Formula: sum(EBOCF_bidÂ£ + EBOCF_offerÂ£)  
- Sources: EBOCF îˆ€citeîˆ‚turn0search2îˆ

**KPI_BMU_002 â€” Discharge Revenue (Â£) / Charge Revenue (Â£)**  
- Level: BMU  
- Cell note: Offer cashflow (discharge/export) and bid cashflow (charge/import).  
- Formula: sum(offerÂ£), sum(bidÂ£)  
- Sources: EBOCF îˆ€citeîˆ‚turn0search2îˆ

**KPI_BMU_003 â€” Volume (MWh) / Net MWh**  
- Level: BMU  
- Cell note: Offer MWh, Bid MWh, and net energy delivered.  
- Formula: offerMWh = sum(BOAV_offer); bidMWh = sum(BOAV_bid); net = offerâˆ’bid  
- Sources: BOAV îˆ€citeîˆ‚turn0search1îˆ

**KPI_BMU_004 â€” Â£/MWh (EWAP)**  
- Level: BMU  
- Cell note: Energy-weighted price for bids/offers and net.  
- Formula: offerEWAP = offerÂ£/offerMWh; bidEWAP = bidÂ£/bidMWh; netEWAP = netÂ£/(offerMWh+bidMWh)  
- Sources: BOAV + EBOCF îˆ€citeîˆ‚turn0search1îˆ‚turn0search2îˆ

**KPI_BMU_005 â€” Active SPs / 48**  
- Level: BMU  
- Cell note: Settlement periods with any accepted MWh (bid or offer).  
- Formula: countDistinct(SP where offerMWh+bidMWh>0)  
- Sources: BOAV îˆ€citeîˆ‚turn0search1îˆ

**KPI_BMU_006 â€” Acceptance Count (BOALF)**  
- Level: BMU  
- Cell note: Number of BOALF acceptances in the window (dispatch frequency).  
- Formula: count(BOALF rows)  
- Sources: BOALF îˆ€citeîˆ‚turn0search4îˆ‚turn0search17îˆ

**KPI_BMU_007 â€” Granularity (MWh per acceptance)**  
- Level: BMU  
- Cell note: Average â€œsizeâ€ of dispatch actions (volume Ã· acceptances).  
- Formula: (offerMWh+bidMWh) / acceptanceCount  
- Sources: BOAV + BOALF îˆ€citeîˆ‚turn0search1îˆ‚turn0search4îˆ

**KPI_BMU_008 â€” Time-of-day profile (% MWh in bands)**  
- Level: BMU  
- Cell note: Share of accepted MWh in bands (e.g., 06:00â€“16:00).  
- Formula: sum(MWh where SP in band)/sum(MWh)  
- Sources: BOAV (by SP) or BOALF (by timeFrom) îˆ€citeîˆ‚turn0search1îˆ‚turn0search4îˆ

---

### C) Bid/Offer stack KPIs (what the market is â€œofferingâ€)

These tell you **how the market is pricing & offering flexibility**, not just what got accepted.

**KPI_STACK_001 â€” Stack Depth (pairs per SP)**  
- Level: Market or BMU  
- Cell note: Number of bid-offer pairs submitted per SP (how granular the stack is).  
- Formula: countDistinct(BOD.pairId) per SP  
- Sources: BOD îˆ€citeîˆ‚turn0search3îˆ‚turn0search7îˆ

**KPI_STACK_002 â€” Defensive Pricing Share (%)**  
- Level: Market or BMU  
- Cell note: % of pairs with extreme prices (e.g., |price| â‰¥ 9,999 or 99,999).  
- Formula: count(pairs where abs(bid)â‰¥X or abs(offer)â‰¥X) / total pairs  
- Sources: BOD îˆ€citeîˆ‚turn0search3îˆ‚turn0search7îˆ

**KPI_STACK_003 â€” Offered Flex MW (sum of band widths)**  
- Level: Market or BMU  
- Cell note: Total MW â€œavailableâ€ in bid or offer direction from submitted bands.  
- Formula: sum(|levelToâˆ’levelFrom|) by direction (pair sign / level sign conventions)  
- Sources: BOD îˆ€citeîˆ‚turn0search7îˆ‚turn0search3îˆ

**KPI_STACK_004 â€” Indicative Spread (Offerâˆ’Bid) (Â£/MWh)**  
- Level: Market or BMU  
- Cell note: Typical bid/offer spread in submitted stack (pricing aggressiveness).  
- Formula: median(offerâˆ’bid) across pairs (filtered to non-defensive)  
- Sources: BOD îˆ€citeîˆ‚turn0search7îˆ‚turn0search3îˆ

---

## 4) Year benchmarks (mean/min/max/percentiles) â€” recommended methodology

### A) Benchmark the right thing (avoid bias)
If you compare **TodaySoFar** at 09:00 to **full-day** historical totals, youâ€™ll always look â€œlowâ€.

Use one of these:
1) **Same-time-of-day benchmark**: for each historical day, compute KPI from 00:00â†’same clock time.  
2) **SP-complete benchmark**: compare todayâ€™s completed SP count (e.g., SP1â€“SP18) to historical SP1â€“SP18.

### B) Baseline stats to store per KPI
For each KPI (market + key BMUs), compute across the last **365 days**:
- mean, min, max
- p10, p50, p90 (or p5/p95)
- standard deviation
- z-score: (todayâˆ’mean)/stdev
- rank percentile of today vs history

### C) â€œMarket contextâ€ comparisons
Recommended â€œmarket vs your BMUâ€ metrics:
- Your BMU share of market Â£ and MWh (today vs 30d avg)
- Your BMU rank (by Â£ and by MWh) across all BMUs

---

## 5) Suggested dashboard layout (cells + notes)

### Header row (Market)
- Total BM Â£ TodaySoFar (KPI_MKT_001)
- Total BM MWh TodaySoFar (KPI_MKT_002)
- Dispatch intensity acceptances/hour (KPI_MKT_005)
- Top-1 share of Â£ (KPI_MKT_006)

### BMU table (Top 10)
- Net Â£, Offer Â£, Bid Â£, Offer MWh, Bid MWh, EWAP, Active SPs, Acceptances, MWh/acceptance

### â€œMarket behaviourâ€ panel (Stack)
- Defensive share, median spread, total offered MW (market-level), stack depth

---

## 6) Quick one-liners for cell Notes (copy/paste)

- **Total BM Â£ (Today)**: â€œSum of indicative bid+offer cashflow across all BMUs from 00:00 local to now (EBOCF).â€
- **Total BM MWh (Today)**: â€œSum of bid+offer accepted MWh across all BMUs from 00:00 local to now (BOAV).â€
- **Dispatch intensity**: â€œBOALF acceptances per hour (count acceptances / hours).â€
- **EWAP Â£/MWh**: â€œEnergy-weighted average price = cashflow Ã· MWh (EBOCF Ã· BOAV).â€
- **Active SPs**: â€œCount of settlement periods with non-zero accepted MWh.â€
- **Defensive share**: â€œ% of submitted pairs with extreme prices (e.g., â‰¥9,999 or â‰¥99,999).â€

---

## 7) Caveats you should display on the dashboard
- BOAV/EBOCF are â€œlatest settlement runâ€ outputs (can change as runs update). îˆ€citeîˆ‚turn0search1îˆ‚turn0search2îˆ  
- Derived pair-level acceptance exists in the UI, but public APIs donâ€™t always expose pair linkage cleanly in raw acceptances. îˆ€citeîˆ‚turn0search5îˆ‚turn0search4îˆ  
- BOALF is operational acceptance-level; settlement totals are better pulled from BOAV/EBOCF for revenue reporting. îˆ€citeîˆ‚turn0search17îˆ‚turn0search2îˆ

1) One-line SQL: todayâ€™s active BMU count (acceptances)

Active = BMU had â‰¥1 BOA/BOALF record today SELECT COUNT(DISTINCT bmUnit) AS active_bmu_count FROM `uk_energy_insights.bmrs_boalf` WHERE settlementDate = CURRENT_DATE("Europe/London"); If your field is nationalGridBmUnit instead of bmUnit, swap it in.

â¸»

2) Split BMUs by technology (BESS / wind / thermal / demand)

This needs a BMU â†’ technology mapping table. In many pipelines itâ€™s something like bmrs_bmu / bm_unit_metadata / bmu_register with fields such as fuelType, bmuType, plantType, etc.

2A) If you have a metadata table with a fuelType field SELECT tech_group, COUNT(DISTINCT b.bmUnit) AS active_bmus
FROM `uk_energy_insights.bmrs_boalf` b
JOIN `uk_energy_insights.bmu_metadata` m USING (bmUnit)
CROSS JOIN UNNEST([STRUCT(
  CASE
    WHEN LOWER(m.fuelType) IN ("battery","bess","storage") THEN "BESS"
    WHEN LOWER(m.fuelType) IN ("wind","offshore wind","onshore wind") THEN "Wind"
    WHEN LOWER(m.fuelType) IN ("solar","pv") THEN "Solar"
    WHEN LOWER(m.fuelType) IN ("demand","demand side response","dsr") OR LOWER(m.bmuType) LIKE "%demand%" THEN "Demand"
    ELSE "Thermal/Other"
  END AS tech_group
)]) 
WHERE b.settlementDate = CURRENT_DATE("Europe/London")
GROUP BY tech_group
ORDER BY active_bmus DESC; 2B) If you donâ€™t have a metadata table yet

You cannot split â€œby technologyâ€ reliably from BOALF alone. You need an authoritative mapping from:
	â€¢	BMU â†’ Fuel Type / BMU type / Plant type / (or Elexon BMU register fields)

If you tell me the name of your BMU metadata table (or paste its schema), Iâ€™ll rewrite the query to match it exactly.

â¸»

Practical notes (to avoid false results)
	â€¢	Active BMU count depends on your definition:
	â€¢	â€œactive = acceptedâ€ (BOALF/BOA) â†’ best for dispatch activity
	â€¢	â€œactive = submittedâ€ (BOD) â†’ bidding participation
	â€¢	Your BMU identifier field might be bmUnit, nationalGridBmUnit, or bmu_id depending on ingestion.

If you paste your dataset + table names (or run SHOW TABLES and paste the relevant ones), Iâ€™ll return final, exact SQL for your environment in the same format. see api : curl -s "https://data.elexon.co.uk/bmrs/api/v1/reference/bmunits/all" curl -s "https://data.elexon.co.uk/bmrs/api/v1/reference/bmunits/all" Join that to BOAL/BOALF acceptances on BMU ID, then group into BESS/wind/thermal/demand. curl -s "https://data.elexon.co.uk/bmrs/api/v1/datasets/DISBSAD?from=2025-12-13T00:00:00Z&to=2025-12-14T00:00:00Z" One important warning (so your numbers donâ€™t go wrong)
	â€¢	BOD = submitted curves (intent)
	â€¢	BOAL/BOALF = accepted actions (what actually cleared)
	â€¢	DISBSAD = cost/flagged action records and can be delayed vs real-time

Elexonâ€™s Insights Solution portal explicitly separates dataset endpoints and also notes streaming endpoints exist for many datasets.  ï¿¼


3) DISBSAD